pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- main
FIRE_SPEED = 8;
BULLET_SPEED = 8;

function _init()
	stars = init_stars();
	bullets = {};
	ship_x = 64;
	ship_y = 100;
	ship_flm_spr = 32;
	shoot_wait_timer = 0;
	can_shoot = true;
end

function _update()
	update_shoot_flg();
	update_bullets();
	handle_input();
	update_ship_gfx();
	update_stars_gfx();
end

function _draw()
	cls(0);
	draw_stars();
	draw_bullets();
	draw_ship();

end
-->8
-- init functions
function init_stars()
	-- stars: {x, y, dy, color}[]
	local stars = {};
	local MAX_STAR_SPEED = 5;

	for i=1,120 do
		local dy = rnd(MAX_STAR_SPEED - 1) + 1;
		local color = 7;

		if dy < 1.5 then
			color = 2;
		elseif dy < 3 then
			color = 5;
		end

		stars[i] = {["x"]=rnd_int(128),["y"]=rnd_int(128),["dy"]=dy, ["c"]=color};
	end

	return stars
end
-->8
-- update functions
function update_stars_gfx()
	for i=1,#stars do
		stars[i]["y"] += stars[i]["dy"]

		if stars[i]["y"] > 127 then
			stars[i]["y"] = 0;	
		end 
	end
end

function update_ship_gfx()
	ship_flm_spr += 1;
	if ship_flm_spr > 36 then
		ship_flm_spr = 32;
	end
end

function update_bullets()
	local bullets_to_del = {};

	-- update pos
	for i=1,#bullets do
		local bullet = bullets[i];
		bullet["y"] -= BULLET_SPEED;
		if bullet["y"] < -16 then
			add(bullets_to_del,i);
		end
	end

	-- remove from array if off screen
	for i=1,#bullets_to_del do
		deli(bullets,bullets_to_del[i]);
	end
end

function update_shoot_flg()
	if not can_shoot then
		shoot_wait_timer += 1;

		if shoot_wait_timer > (30 / FIRE_SPEED) - 1 then
			can_shoot = true;
		end
	end
end

function shoot()
	add(bullets,{["x"]=ship_x,["y"]=ship_y - 10});
	sfx(0);
	can_shoot = false;
	shoot_wait_timer = 0;
end

-->8
-- draw functions
function draw_ship()
	-- spr(ship_flm_spr,ship_x,ship_y + 7)
	spr(ship_spr,ship_x,ship_y);
end

function draw_stars()
	for i=1,#stars do
		pset(stars[i]["x"],stars[i]["y"],stars[i]["c"]);
	end	
end

function draw_bullets()
	for i=1,#bullets do
		bullet = bullets[i];
		spr(21,bullet["x"],bullet["y"]);
	end
end

-->8
-- player input
function handle_input()
	ship_spr = 17;
	if (btn(⬅️)) then ship_x -= 3; ship_spr = 16; end
	if (btn(➡️)) then ship_x += 3; ship_spr = 18; end
	if (btn(⬆️)) then ship_y -= 2 end
	if (btn(⬇️)) then ship_y += 2 end
	if (btn(🅾️) and can_shoot) then 
		shoot();
	end 
end


-->8
-- util
function rnd_int(n)
	return flr(rnd(n)); 
end

__gfx__
00000000000cc0000009900080000008000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000a00
00000000000cc00009744790880000880000000000000000000000000000000000000000000000000000000000000000000000000000000000d0000000300000
0070070000c55c00977777790087780000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000a0000a0
000770000c0660c097777779000880000000000000000000000000000000000000000000000000000000000000000000000000000000000003a0000a0a000a00
00077000ccc66ccc00aaaa000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00aaaa002000
00700700c0c00c0c0007700000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ad9999aa0000
0000000000c00c00097777900880088000000000000000000000000000000000000000000000000000000000000000000000000000000000000aa99aa99a0000
0000000000000000009999008080080800000000000000000000000000000000000000000000000000000000000000000000000000000000a0aa99a9aa99a000
0007700000077000000770000000000000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000a2d9aa93aa92a0a
00cc7000007cc7000007cc00000000000bb33bb0000bb0000000000000000000000000000000000000000000000000000000000000000000000d9aad99a9aaa0
00777000707777070007770000055000bb33336b00b77b0000000000000000000000000000000000000000000000000000000000000000000a0d39a9aaa9d000
07cc7700077cc7700077cc7000055000b336b33b0b0000b00000000000000000000000000000000000000000000000000000000000000000a000a99aa99a0000
76777700777777770077776700099000b33b633bb000000b00000000000000000000000000000000000000000000000000000000000000000000aa99993a0000
00cc7600707cc7070067cc0000099000b63333bb000000000000000000000000000000000000000000000000000000000000000000000000000a00a2aa00a000
007770007077770700077700000990000bb33bb000000000000000000000000000000000000000000000000000000000000000000000000000d000000a000a00
0007700000077000000770000099990000bbbb000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000a0
000aa000000aa000000aa000000aa000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00aaaa0000aaaa0000aaaa0000aaaa0000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08a88a8008a88a800999999008a99a8008a88a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
090880900a0000a0090aa0900a0000a0090880900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100003d3403d3403d3403c3403b3403934036340313502d3502435017310003000230002300003000230002300023000230002300023000230002300023000230002300023000230002300003000130002300
